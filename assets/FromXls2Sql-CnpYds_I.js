import{u as ae,o as le,a as A,F as te,g as M,h as se,f as Y,i as j,k as oe}from"./primevue-DrPXlnFP.js";import{_ as ne}from"./BreadcrumbNav.vue_vue_type_script_setup_true_lang-C1ElsLfU.js";import{r as ie,u as re}from"./xlsx-BWspZQq9.js";import{P as ce,r as p,L as ue,c as _,x as d,e as t,Y as de,j as L,k as me,A as D,R as m,p as B,B as y,t as N,d as S}from"./vue-vendor-D8N656sj.js";import{_ as ve}from"./index-C99OtVWq.js";const pe={class:"w-full max-w-[90%] bg-white shadow-lg rounded-2xl p-4 md:p-6 space-y-6 mb-16"},fe={class:"space-y-4"},ge={class:"space-y-4"},be={class:"flex flex-col sm:flex-row gap-3"},xe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ye={class:"relative"},$e={class:"relative"},he={class:"flex items-center gap-2"},Se=["src","alt"],Ee={key:0,class:"flex items-center gap-2"},we=["src","alt"],Te={class:"relative"},_e={class:"relative"},Le={key:0,class:"text-sm text-red-600 bg-red-100 border border-red-300 p-2 rounded-md mt-1"},Ne={key:1,class:"space-y-2"},Ie={class:"flex flex-col sm:flex-row justify-end gap-3"},ke=ce({__name:"FromXls2Sql",setup(qe){const U=ae(),b=p(""),v=p("mysql"),q=p("yes"),C=p("no"),x=p(""),$=p(""),E=p(""),R=p(""),w=p(null),V=p(""),I=[{name:"MySQL / MariaDB",value:"mysql",icon:"mysql.svg"},{name:"PostgreSQL",value:"postgresql",icon:"postgresql.svg"},{name:"SQL Server",value:"sqlserver",icon:"sql-server.svg"},{name:"Oracle",value:"oracle",icon:"oracle.svg"}],O=[{name:"S√≠, generar CREATE TABLE",value:"yes"},{name:"No, solo INSERT INTO",value:"no"}],z=[{name:"S√≠, generar migraci√≥n",value:"yes"},{name:"No",value:"no"}],F=ue(()=>{const l=b.value.trim();return/^[a-z][a-z0-9_]*$/.test(l)}),Q=()=>{const l=b.value.trim().toLowerCase();b.value=l;const e=/^[a-z][a-z0-9_]*$/.test(l);l===""?E.value="":e?(E.value="‚úÖ Nombre v√°lido",R.value="text-green-600"):(E.value="‚ùå Nombre inv√°lido",R.value="text-red-600")},K=l=>{const e=[],n=o=>/^-?\d+$/.test(o),r=o=>/^-?\d+\.\d+$/.test(o),u=o=>/^\d{4}-\d{2}-\d{2}$/.test(o),f=l[0].length;for(let o=0;o<f;o++){const i=[];for(let g=1;g<l.length&&i.length<1e3;g++){const k=l[g][o];k!=null&&String(k).trim()!==""&&i.push(String(k))}let s=!0,c=!0,h=!0,T=0;for(const g of i)n(g)||(s=!1),!r(g)&&!n(g)&&(c=!1),u(g)||(h=!1),T=Math.max(T,g.length);T=T*10,s?e.push("INT"):c?e.push("FLOAT"):h?e.push("DATE"):e.push(`VARCHAR(${Math.min(T,255)})`)}return e},P=(l,e,a)=>{let n="`",r="`",u="`"+l+"`";v.value==="postgresql"||v.value==="oracle"?(n=r='"',u=`"${l}"`):v.value==="sqlserver"&&(n="[",r="]",u=`[${l}]`);const f=e.map((o,i)=>{let s=a[i];return o==="id"&&s==="INT"&&(v.value==="mysql"?s="INT AUTO_INCREMENT PRIMARY KEY":v.value==="postgresql"?s="SERIAL PRIMARY KEY":v.value==="sqlserver"?s="INT IDENTITY(1,1) PRIMARY KEY":v.value==="oracle"&&(s="NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY")),`${n}${o}${r} ${s}`});return`CREATE TABLE ${u} (
  ${f.join(`,
  `)}
);`},W=(l,e,a)=>{let n="`",r="`",u="`"+l+"`";v.value==="postgresql"||v.value==="oracle"?(n=r='"',u=`"${l}"`):v.value==="sqlserver"&&(n="[",r="]",u=`[${l}]`);const f=e.map(i=>`${n}${i}${r}`).join(", "),o=[];for(let i=1;i<a.length;i++){const s=a[i].map(c=>c==null?"NULL":typeof c=="string"?`'${c.replace(/'/g,"''")}'`:c);o.push(`(${s.join(", ")})`)}return o.length===0?"":`INSERT INTO ${u} (${f})
VALUES
${o.join(`,
`)};`},G=(l,e,a,n)=>{const r=`m${Date.now()}_${l}`,u=e.map((o,i)=>{let s=a[i].toLowerCase();return s.startsWith("varchar")?s=`$this->string(${s.match(/\((\d+)\)/)?.[1]||"255"})`:s==="int"?s="$this->integer()":s==="float"?s="$this->float()":s==="date"&&(s="$this->date()"),o==="id"&&s==="$this->integer()"&&(s+="->primaryKey()"),`            '${o}' => ${s},`}),f=n.slice(1).map(o=>{const i={};return e.forEach((s,c)=>{i[s]=o[c]}),i});return`<?php

use yii\\db\\Migration;

class ${r} extends Migration
{
    public function safeUp()
    {
        $this->createTable('{{%${l}}}', [
${u.join(`
`)}
        ]);

        $this->batchInsert('{{%${l}}}', 
            ['${e.join("', '")}'],
            ${JSON.stringify(f,null,4)}
        );
    }

    public function safeDown()
    {
        $this->dropTable('{{%${l}}}');
    }
}`},X=async l=>{try{const e=await l.arrayBuffer(),a=ie(e,{type:"array"});if(a.SheetNames.length!==1){x.value="El archivo debe contener exactamente una hoja.";return}const n=a.Sheets[a.SheetNames[0]],r=re.sheet_to_json(n,{header:1});if(r.length===0||r[0].length===0){x.value="No se detectaron encabezados en la primera fila.";return}const u=r[0].map(h=>h.toLowerCase()),f=/^[a-z][a-z0-9_]*$/,o=u.filter(h=>!f.test(h));if(o.length>0){x.value="Nombres de columnas inv√°lidos: "+o.join(", ");return}const i=K(r),s=b.value.trim();let c="";q.value==="yes"&&(c+=P(s,u,i)+`

`),c+=W(s,u,r),C.value==="yes"&&(c+=`

/* === Yii2 Migration === */

`+G(s,u,i,r)),$.value=c,x.value=""}catch(e){x.value="Error al procesar el archivo: "+e.message}},H=l=>{w.value=l.files[0],V.value=l.files[0].name},J=()=>{w.value&&X(w.value)},Z=async()=>{try{await navigator.clipboard.writeText($.value),U.add({severity:"success",summary:"Copiado",detail:"SQL copiado al portapapeles",life:3e3})}catch{U.add({severity:"error",summary:"Error",detail:"No se pudo copiar al portapapeles",life:3e3})}},ee=()=>{const l=new Blob([$.value],{type:"text/plain"}),e=window.URL.createObjectURL(l),a=document.createElement("a");a.href=e,a.download=`${b.value}_${new Date().toISOString().split("T")[0]}.sql`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(e),document.body.removeChild(a)};return(l,e)=>(S(),_("div",null,[d(ne),t("div",pe,[t("div",fe,[e[14]||(e[14]=de('<div data-v-e62ccac6><h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600" data-v-e62ccac6> üß© Convertidor de Excel a SQL </h1></div><div class="text-sm text-gray-600 text-center" data-v-e62ccac6> Sube un archivo <strong data-v-e62ccac6>.csv</strong>, <strong data-v-e62ccac6>.xls</strong> o <strong data-v-e62ccac6>.xlsx</strong> que contenga los datos.<br data-v-e62ccac6> Aseg√∫rate de que: </div><div data-v-e62ccac6><ul class="text-sm text-gray-600 list-disc list-inside" data-v-e62ccac6><li data-v-e62ccac6>La primera fila tenga los nombres de las columnas</li><li data-v-e62ccac6>Solo haya una hoja (en archivos Excel)</li><li data-v-e62ccac6> Los nombres de columna sean v√°lidos (letras, n√∫meros, guion bajo, comienzan con letra) </li><li data-v-e62ccac6> Debes elegir si deseas generar tambi√©n el bloque <code data-v-e62ccac6>CREATE TABLE</code></li><li data-v-e62ccac6>Debes proporcionar el nombre de la tabla</li></ul></div>',3)),t("div",ge,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[t("span",{class:"text-red-500"},"*"),D(" Selecciona un archivo ")],-1)),t("div",be,[d(m(le),{mode:"basic",auto:!1,accept:".csv,.xls,.xlsx",onSelect:H,chooseLabel:"Elegir archivo",class:"flex-1"}),d(m(A),{disabled:!w.value||!F.value,onClick:J,icon:"pi pi-file-edit",label:"Procesar",class:B(["w-full sm:w-36",!w.value||!F.value?"p-button-secondary opacity-60":"p-button-primary"])},null,8,["disabled","class"])]),V.value?(S(),me(m(te),{key:0,severity:"info",size:"small"},{default:y(()=>[e[5]||(e[5]=t("i",{class:"pi pi-check"},null,-1)),D(" "+N(V.value),1)]),_:1,__:[5]})):L("",!0)])]),t("div",xe,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[t("span",{class:"text-red-500"},"*"),D(" Nombre de tabla ")],-1)),t("div",ye,[d(m(Y),null,{default:y(()=>[d(m(M),null,{default:y(()=>e[7]||(e[7]=[t("i",{class:"pi pi-database"},null,-1)])),_:1,__:[7]}),d(m(se),{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),class:"w-full",placeholder:"ej: usuarios",onInput:Q},null,8,["modelValue"])]),_:1})]),E.value?(S(),_("div",{key:0,class:B([R.value,"text-sm mt-1"])},N(E.value),3)):L("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Formato SQL ",-1)),t("div",$e,[d(m(Y),null,{default:y(()=>[d(m(M),null,{default:y(()=>e[9]||(e[9]=[t("i",{class:"pi pi-database"},null,-1)])),_:1,__:[9]}),d(m(j),{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),options:I,optionLabel:"name",optionValue:"value",class:"w-full"},{option:y(a=>[t("div",he,[t("img",{src:`icons/${a.option.icon}`,alt:a.option.name,class:"w-5 h-5"},null,8,Se),t("span",null,N(a.option.name),1)])]),value:y(a=>[a.value?(S(),_("div",Ee,[t("img",{src:`icons/${I.find(n=>n.value===a.value)?.icon}`,alt:I.find(n=>n.value===a.value)?.name,class:"w-5 h-5"},null,8,we),t("span",null,N(I.find(n=>n.value===a.value)?.name),1)])):L("",!0)]),_:1},8,["modelValue"])]),_:1})])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øIncluir bloque CREATE TABLE? ",-1)),t("div",Te,[d(m(j),{modelValue:q.value,"onUpdate:modelValue":e[2]||(e[2]=a=>q.value=a),options:O,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øGenerar una migraci√≥n Yii2? ",-1)),t("div",_e,[d(m(j),{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=a=>C.value=a),options:z,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])])]),x.value?(S(),_("div",Le,N(x.value),1)):L("",!0),$.value?(S(),_("div",Ne,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"Resultado SQL",-1)),d(m(oe),{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=a=>$.value=a),readonly:"",class:"w-full h-64 p-3 text-sm font-mono"},null,8,["modelValue"]),t("div",Ie,[d(m(A),{onClick:Z,icon:"pi pi-copy",label:"Copiar SQL",class:"w-full sm:w-auto p-button-primary"}),d(m(A),{onClick:ee,icon:"pi pi-download",label:"Descargar .sql",class:"w-full sm:w-auto p-button-success"})])])):L("",!0)])])]))}}),De=ve(ke,[["__scopeId","data-v-e62ccac6"]]);export{De as default};
