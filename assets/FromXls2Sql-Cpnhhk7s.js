import{u as le,o as te,a as R,F as se,g as U,h as oe,f as B,i as D,k as ne}from"./primevue-CTM77RMy.js";import{_ as ie}from"./BreadcrumbNav.vue_vue_type_script_setup_true_lang-D5HMXHe9.js";import{r as re,u as ce}from"./xlsx-BWspZQq9.js";import{c as ue,F as de,_ as me}from"./index-BbAnu8e5.js";import{C as ve}from"./check-BeRjoNd_.js";import{C as pe}from"./copy-Q45y3h1A.js";import{D as fe}from"./download-Bx4kx5V9.js";import{P as be,r as p,L as ge,c as T,x as i,e as s,X as ye,j as L,k as xe,A as j,R as r,B as f,p as Y,t as N,d as w}from"./vue-vendor-ByoO1CXK.js";/**
 * @license lucide-vue-next v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=ue("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),he={class:"w-full max-w-[90%] bg-white shadow-lg rounded-2xl p-4 md:p-6 space-y-6 mb-16"},$e={class:"space-y-4"},we={class:"space-y-4"},Se={class:"flex flex-col sm:flex-row gap-3"},Ee={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},_e={class:"relative"},Te={class:"relative"},Le={class:"flex items-center gap-2"},Ne=["src","alt"],ke={key:0,class:"flex items-center gap-2"},Ce=["src","alt"],Ie={class:"relative"},Ve={class:"relative"},Ae={key:0,class:"text-sm text-red-600 bg-red-100 border border-red-300 p-2 rounded-md mt-1"},qe={key:1,class:"space-y-2"},Re={class:"flex flex-col sm:flex-row justify-end gap-3"},De=be({__name:"FromXls2Sql",setup(je){const F=le(),y=p(""),v=p("mysql"),I=p("yes"),V=p("no"),x=p(""),h=p(""),S=p(""),A=p(""),E=p(null),q=p(""),k=[{name:"MySQL / MariaDB",value:"mysql",icon:"mysql.svg"},{name:"PostgreSQL",value:"postgresql",icon:"postgresql.svg"},{name:"SQL Server",value:"sqlserver",icon:"sql-server.svg"},{name:"Oracle",value:"oracle",icon:"oracle.svg"}],O=[{name:"S√≠, generar CREATE TABLE",value:"yes"},{name:"No, solo INSERT INTO",value:"no"}],Q=[{name:"S√≠, generar migraci√≥n",value:"yes"},{name:"No",value:"no"}],M=ge(()=>{const l=y.value.trim();return/^[a-z][a-z0-9_]*$/.test(l)}),K=()=>{const l=y.value.trim().toLowerCase();y.value=l;const e=/^[a-z][a-z0-9_]*$/.test(l);l===""?S.value="":e?(S.value="‚úÖ Nombre v√°lido",A.value="text-green-600"):(S.value="‚ùå Nombre inv√°lido",A.value="text-red-600")},P=l=>{const e=[],n=o=>/^-?\d+$/.test(o),u=o=>/^-?\d+\.\d+$/.test(o),m=o=>/^\d{4}-\d{2}-\d{2}$/.test(o),b=l[0].length;for(let o=0;o<b;o++){const c=[];for(let g=1;g<l.length&&c.length<1e3;g++){const C=l[g][o];C!=null&&String(C).trim()!==""&&c.push(String(C))}let t=!0,d=!0,$=!0,_=0;for(const g of c)n(g)||(t=!1),!u(g)&&!n(g)&&(d=!1),m(g)||($=!1),_=Math.max(_,g.length);_=_*10,t?e.push("INT"):d?e.push("FLOAT"):$?e.push("DATE"):e.push(`VARCHAR(${Math.min(_,255)})`)}return e},W=(l,e,a)=>{let n="`",u="`",m="`"+l+"`";v.value==="postgresql"||v.value==="oracle"?(n=u='"',m=`"${l}"`):v.value==="sqlserver"&&(n="[",u="]",m=`[${l}]`);const b=e.map((o,c)=>{let t=a[c];return o==="id"&&t==="INT"&&(v.value==="mysql"?t="INT AUTO_INCREMENT PRIMARY KEY":v.value==="postgresql"?t="SERIAL PRIMARY KEY":v.value==="sqlserver"?t="INT IDENTITY(1,1) PRIMARY KEY":v.value==="oracle"&&(t="NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY")),`${n}${o}${u} ${t}`});return`CREATE TABLE ${m} (
  ${b.join(`,
  `)}
);`},X=(l,e,a)=>{let n="`",u="`",m="`"+l+"`";v.value==="postgresql"||v.value==="oracle"?(n=u='"',m=`"${l}"`):v.value==="sqlserver"&&(n="[",u="]",m=`[${l}]`);const b=e.map(c=>`${n}${c}${u}`).join(", "),o=[];for(let c=1;c<a.length;c++){const t=a[c].map(d=>d==null?"NULL":typeof d=="string"?`'${d.replace(/'/g,"''")}'`:d);o.push(`(${t.join(", ")})`)}return o.length===0?"":`INSERT INTO ${m} (${b})
VALUES
${o.join(`,
`)};`},G=(l,e,a,n)=>{const u=`m${Date.now()}_${l}`,m=e.map((o,c)=>{let t=a[c].toLowerCase();return t.startsWith("varchar")?t=`$this->string(${t.match(/\((\d+)\)/)?.[1]||"255"})`:t==="int"?t="$this->integer()":t==="float"?t="$this->float()":t==="date"&&(t="$this->date()"),o==="id"&&t==="$this->integer()"&&(t+="->primaryKey()"),`            '${o}' => ${t},`}),b=n.slice(1).map(o=>{const c={};return e.forEach((t,d)=>{c[t]=o[d]}),c});return`<?php

use yii\\db\\Migration;

class ${u} extends Migration
{
    public function safeUp()
    {
        $this->createTable('{{%${l}}}', [
${m.join(`
`)}
        ]);

        $this->batchInsert('{{%${l}}}', 
            ['${e.join("', '")}'],
            ${JSON.stringify(b,null,4)}
        );
    }

    public function safeDown()
    {
        $this->dropTable('{{%${l}}}');
    }
}`},H=async l=>{try{const e=await l.arrayBuffer(),a=re(e,{type:"array"});if(a.SheetNames.length!==1){x.value="El archivo debe contener exactamente una hoja.";return}const n=a.Sheets[a.SheetNames[0]],u=ce.sheet_to_json(n,{header:1});if(u.length===0||u[0].length===0){x.value="No se detectaron encabezados en la primera fila.";return}const m=u[0].map($=>$.toLowerCase()),b=/^[a-z][a-z0-9_]*$/,o=m.filter($=>!b.test($));if(o.length>0){x.value="Nombres de columnas inv√°lidos: "+o.join(", ");return}const c=P(u),t=y.value.trim();let d="";I.value==="yes"&&(d+=W(t,m,c)+`

`),d+=X(t,m,u),V.value==="yes"&&(d+=`

/* === Yii2 Migration === */

`+G(t,m,c,u)),h.value=d,x.value=""}catch(e){x.value="Error al procesar el archivo: "+e.message}},J=l=>{E.value=l.files[0],q.value=l.files[0].name},Z=()=>{E.value&&H(E.value)},ee=async()=>{try{await navigator.clipboard.writeText(h.value),F.add({severity:"success",summary:"Copiado",detail:"SQL copiado al portapapeles",life:3e3})}catch{F.add({severity:"error",summary:"Error",detail:"No se pudo copiar al portapapeles",life:3e3})}},ae=()=>{const l=new Blob([h.value],{type:"text/plain"}),e=window.URL.createObjectURL(l),a=document.createElement("a");a.href=e,a.download=`${y.value}_${new Date().toISOString().split("T")[0]}.sql`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(e),document.body.removeChild(a)};return(l,e)=>(w(),T("div",null,[i(ie),s("div",he,[s("div",$e,[e[11]||(e[11]=ye('<div data-v-8a2eba43><h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600" data-v-8a2eba43> üß© Convertidor de Excel a SQL </h1></div><div class="text-sm text-gray-600 text-center" data-v-8a2eba43> Sube un archivo <strong data-v-8a2eba43>.csv</strong>, <strong data-v-8a2eba43>.xls</strong> o <strong data-v-8a2eba43>.xlsx</strong> que contenga los datos.<br data-v-8a2eba43> Aseg√∫rate de que: </div><div data-v-8a2eba43><ul class="text-sm text-gray-600 list-disc list-inside" data-v-8a2eba43><li data-v-8a2eba43>La primera fila tenga los nombres de las columnas</li><li data-v-8a2eba43>Solo haya una hoja (en archivos Excel)</li><li data-v-8a2eba43> Los nombres de columna sean v√°lidos (letras, n√∫meros, guion bajo, comienzan con letra) </li><li data-v-8a2eba43> Debes elegir si deseas generar tambi√©n el bloque <code data-v-8a2eba43>CREATE TABLE</code></li><li data-v-8a2eba43>Debes proporcionar el nombre de la tabla</li></ul></div>',3)),s("div",we,[s("div",null,[e[5]||(e[5]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[s("span",{class:"text-red-500"},"*"),j(" Selecciona un archivo ")],-1)),s("div",Se,[i(r(te),{mode:"basic",auto:!1,accept:".csv,.xls,.xlsx",onSelect:J,chooseLabel:"Elegir archivo",class:"flex-1"}),i(r(R),{disabled:!E.value||!M.value,onClick:Z,label:"Procesar",class:Y(["w-full sm:w-36",!E.value||!M.value?"p-button-secondary opacity-60":"p-button-primary"])},{icon:f(()=>[i(r(de),{class:"w-4 h-4 mr-2"})]),_:1},8,["disabled","class"])]),q.value?(w(),xe(r(se),{key:0,severity:"info",size:"small"},{default:f(()=>[i(r(ve),{class:"w-4 h-4 inline mr-1"}),j(" "+N(q.value),1)]),_:1})):L("",!0)])]),s("div",Ee,[s("div",null,[e[6]||(e[6]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[s("span",{class:"text-red-500"},"*"),j(" Nombre de tabla ")],-1)),s("div",_e,[i(r(B),null,{default:f(()=>[i(r(U),null,{default:f(()=>[i(r(z),{class:"w-4 h-4"})]),_:1}),i(r(oe),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),class:"w-full",placeholder:"ej: usuarios",onInput:K},null,8,["modelValue"])]),_:1})]),S.value?(w(),T("div",{key:0,class:Y([A.value,"text-sm mt-1"])},N(S.value),3)):L("",!0)]),s("div",null,[e[7]||(e[7]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Formato SQL ",-1)),s("div",Te,[i(r(B),null,{default:f(()=>[i(r(U),null,{default:f(()=>[i(r(z),{class:"w-4 h-4"})]),_:1}),i(r(D),{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),options:k,optionLabel:"name",optionValue:"value",class:"w-full"},{option:f(a=>[s("div",Le,[s("img",{src:`icons/${a.option.icon}`,alt:a.option.name,class:"w-5 h-5"},null,8,Ne),s("span",null,N(a.option.name),1)])]),value:f(a=>[a.value?(w(),T("div",ke,[s("img",{src:`icons/${k.find(n=>n.value===a.value)?.icon}`,alt:k.find(n=>n.value===a.value)?.name,class:"w-5 h-5"},null,8,Ce),s("span",null,N(k.find(n=>n.value===a.value)?.name),1)])):L("",!0)]),_:1},8,["modelValue"])]),_:1})])]),s("div",null,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øIncluir bloque CREATE TABLE? ",-1)),s("div",Ie,[i(r(D),{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=a=>I.value=a),options:O,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),s("div",null,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øGenerar una migraci√≥n Yii2? ",-1)),s("div",Ve,[i(r(D),{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value=a),options:Q,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])])]),x.value?(w(),T("div",Ae,N(x.value),1)):L("",!0),h.value?(w(),T("div",qe,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-gray-700"},"Resultado SQL",-1)),i(r(ne),{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),readonly:"",class:"w-full h-64 p-3 text-sm font-mono"},null,8,["modelValue"]),s("div",Re,[i(r(R),{onClick:ee,label:"Copiar SQL",class:"w-full sm:w-auto p-button-primary"},{icon:f(()=>[i(r(pe),{class:"w-4 h-4 mr-2"})]),_:1}),i(r(R),{onClick:ae,label:"Descargar .sql",class:"w-full sm:w-auto p-button-success"},{icon:f(()=>[i(r(fe),{class:"w-4 h-4 mr-2"})]),_:1})])])):L("",!0)])])]))}}),Ke=me(De,[["__scopeId","data-v-8a2eba43"]]);export{Ke as default};
