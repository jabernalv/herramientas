import{u as J,k as Z,a as A,z as ee,l as R,h as te}from"./primevue-DvzBmhoV.js";import{r as le,u as se}from"./xlsx-BWspZQq9.js";import{O as ae,r as m,S as oe,c as w,e as t,x as v,B as ne,A as N,f as ie,Y as re,j as _,Q as b,p as M,t as q,d as T}from"./vue-vendor-DUAHcAAF.js";import{_ as ue}from"./index-DS413SqP.js";const de={class:"bg-gray-100 py-2 px-4 rounded-md shadow-sm mb-6"},ce={class:"text-sm","aria-label":"Miga de pan"},me={class:"list-none p-0 inline-flex space-x-2"},ve={class:"flex items-center"},pe={class:"w-full max-w-[90%] bg-white shadow-lg rounded-2xl p-4 md:p-6 space-y-6 mb-16"},fe={class:"space-y-4"},be={class:"space-y-4"},ge={class:"flex flex-col sm:flex-row gap-3"},xe={key:0,class:"text-sm text-green-600 flex items-center gap-1 mt-1"},ye={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},he={class:"relative"},$e={class:"relative"},Se={class:"relative"},Ee={class:"relative"},we={key:0,class:"text-sm text-red-600 bg-red-100 border border-red-300 p-2 rounded-md mt-1"},Te={key:1,class:"space-y-2"},Le={class:"flex flex-col sm:flex-row justify-end gap-3"},Ne=ae({__name:"FromXls2Sql",setup(_e){const j=J(),g=m(""),c=m("mysql"),C=m("yes"),I=m("no"),x=m(""),y=m(""),$=m(""),k=m(""),S=m(null),V=m(""),U=[{name:"MySQL / MariaDB",value:"mysql"},{name:"PostgreSQL",value:"postgresql"},{name:"SQL Server",value:"sqlserver"},{name:"Oracle",value:"oracle"}],Y=[{name:"S√≠, generar CREATE TABLE",value:"yes"},{name:"No, solo INSERT INTO",value:"no"}],F=[{name:"S√≠, generar migraci√≥n",value:"yes"},{name:"No",value:"no"}],D=oe(()=>{const l=g.value.trim();return/^[a-z][a-z0-9_]*$/.test(l)}),O=()=>{const l=g.value.trim().toLowerCase();g.value=l;const e=/^[a-z][a-z0-9_]*$/.test(l);l===""?$.value="":e?($.value="‚úÖ Nombre v√°lido",k.value="text-green-600"):($.value="‚ùå Nombre inv√°lido",k.value="text-red-600")},B=l=>{const e=[],a=o=>/^-?\d+$/.test(o),r=o=>/^-?\d+\.\d+$/.test(o),d=o=>/^\d{4}-\d{2}-\d{2}$/.test(o),p=l[0].length;for(let o=0;o<p;o++){const i=[];for(let f=1;f<l.length&&i.length<1e3;f++){const L=l[f][o];L!=null&&String(L).trim()!==""&&i.push(String(L))}let s=!0,u=!0,h=!0,E=0;for(const f of i)a(f)||(s=!1),!r(f)&&!a(f)&&(u=!1),d(f)||(h=!1),E=Math.max(E,f.length);E=E*10,s?e.push("INT"):u?e.push("FLOAT"):h?e.push("DATE"):e.push(`VARCHAR(${Math.min(E,255)})`)}return e},z=(l,e,n)=>{let a="`",r="`",d="`"+l+"`";c.value==="postgresql"||c.value==="oracle"?(a=r='"',d=`"${l}"`):c.value==="sqlserver"&&(a="[",r="]",d=`[${l}]`);const p=e.map((o,i)=>{let s=n[i];return o==="id"&&s==="INT"&&(c.value==="mysql"?s="INT AUTO_INCREMENT PRIMARY KEY":c.value==="postgresql"?s="SERIAL PRIMARY KEY":c.value==="sqlserver"?s="INT IDENTITY(1,1) PRIMARY KEY":c.value==="oracle"&&(s="NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY")),`${a}${o}${r} ${s}`});return`CREATE TABLE ${d} (
  ${p.join(`,
  `)}
);`},Q=(l,e,n)=>{let a="`",r="`",d="`"+l+"`";c.value==="postgresql"||c.value==="oracle"?(a=r='"',d=`"${l}"`):c.value==="sqlserver"&&(a="[",r="]",d=`[${l}]`);const p=e.map(i=>`${a}${i}${r}`).join(", "),o=[];for(let i=1;i<n.length;i++){const s=n[i].map(u=>u==null?"NULL":typeof u=="string"?`'${u.replace(/'/g,"''")}'`:u);o.push(`(${s.join(", ")})`)}return o.length===0?"":`INSERT INTO ${d} (${p})
VALUES
${o.join(`,
`)};`},P=(l,e,n,a)=>{const r=`m${Date.now()}_${l}`,d=e.map((o,i)=>{let s=n[i].toLowerCase();return s.startsWith("varchar")?s=`$this->string(${s.match(/\((\d+)\)/)?.[1]||"255"})`:s==="int"?s="$this->integer()":s==="float"?s="$this->float()":s==="date"&&(s="$this->date()"),o==="id"&&s==="$this->integer()"&&(s+="->primaryKey()"),`            '${o}' => ${s},`}),p=a.slice(1).map(o=>{const i={};return e.forEach((s,u)=>{i[s]=o[u]}),i});return`<?php

use yii\\db\\Migration;

class ${r} extends Migration
{
    public function safeUp()
    {
        $this->createTable('{{%${l}}}', [
${d.join(`
`)}
        ]);

        $this->batchInsert('{{%${l}}}', 
            ['${e.join("', '")}'],
            ${JSON.stringify(p,null,4)}
        );
    }

    public function safeDown()
    {
        $this->dropTable('{{%${l}}}');
    }
}`},K=async l=>{try{const e=await l.arrayBuffer(),n=le(e,{type:"array"});if(n.SheetNames.length!==1){x.value="El archivo debe contener exactamente una hoja.";return}const a=n.Sheets[n.SheetNames[0]],r=se.sheet_to_json(a,{header:1});if(r.length===0||r[0].length===0){x.value="No se detectaron encabezados en la primera fila.";return}const d=r[0].map(h=>h.toLowerCase()),p=/^[a-z][a-z0-9_]*$/,o=d.filter(h=>!p.test(h));if(o.length>0){x.value="Nombres de columnas inv√°lidos: "+o.join(", ");return}const i=B(r),s=g.value.trim();let u="";C.value==="yes"&&(u+=z(s,d,i)+`

`),u+=Q(s,d,r),I.value==="yes"&&(u+=`

/* === Yii2 Migration === */

`+P(s,d,i,r)),y.value=u,x.value=""}catch(e){x.value="Error al procesar el archivo: "+e.message}},W=l=>{S.value=l.files[0],V.value=l.files[0].name},G=()=>{S.value&&K(S.value)},H=async()=>{try{await navigator.clipboard.writeText(y.value),j.add({severity:"success",summary:"Copiado",detail:"SQL copiado al portapapeles",life:3e3})}catch{j.add({severity:"error",summary:"Error",detail:"No se pudo copiar al portapapeles",life:3e3})}},X=()=>{const l=new Blob([y.value],{type:"text/plain"}),e=window.URL.createObjectURL(l),n=document.createElement("a");n.href=e,n.download=`${g.value}_${new Date().toISOString().split("T")[0]}.sql`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(e),document.body.removeChild(n)};return(l,e)=>{const n=ie("router-link");return T(),w("div",null,[t("div",de,[t("nav",ce,[t("ol",me,[t("li",ve,[v(n,{to:"/",class:"text-blue-500 hover:text-blue-700"},{default:ne(()=>e[5]||(e[5]=[t("i",{class:"inline-block w-4 h-4 mr-1 align-text-bottom"},null,-1),N(" Herramientas ")])),_:1,__:[5]})]),e[6]||(e[6]=t("li",null,[t("i",{class:"inline-block w-4 h-4 text-gray-400 align-text-bottom"})],-1)),e[7]||(e[7]=t("li",{class:"text-gray-700"},"Convertidor Excel a SQL",-1))])])]),t("div",pe,[t("div",fe,[e[15]||(e[15]=re('<div data-v-65299e7b><h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600" data-v-65299e7b> üß© Convertidor de Excel a SQL </h1></div><div class="text-sm text-gray-600 text-center" data-v-65299e7b> Sube un archivo <strong data-v-65299e7b>.csv</strong>, <strong data-v-65299e7b>.xls</strong> o <strong data-v-65299e7b>.xlsx</strong> que contenga los datos.<br data-v-65299e7b> Aseg√∫rate de que: </div><div data-v-65299e7b><ul class="text-sm text-gray-600 list-disc list-inside" data-v-65299e7b><li data-v-65299e7b>La primera fila tenga los nombres de las columnas</li><li data-v-65299e7b>Solo haya una hoja (en archivos Excel)</li><li data-v-65299e7b> Los nombres de columna sean v√°lidos (letras, n√∫meros, guion bajo, comienzan con letra) </li><li data-v-65299e7b> Debes elegir si deseas generar tambi√©n el bloque <code data-v-65299e7b>CREATE TABLE</code></li><li data-v-65299e7b>Debes proporcionar el nombre de la tabla</li></ul></div>',3)),t("div",be,[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[t("span",{class:"text-red-500"},"*"),N(" Selecciona un archivo ")],-1)),t("div",ge,[v(b(Z),{mode:"basic",auto:!1,accept:".csv,.xls,.xlsx",onSelect:W,chooseLabel:"Elegir archivo",class:"flex-1"}),v(b(A),{disabled:!S.value||!D.value,onClick:G,icon:"pi pi-file-edit",label:"Procesar",class:M(["w-full sm:w-36",!S.value||!D.value?"p-button-secondary opacity-60":"p-button-primary"])},null,8,["disabled","class"])]),V.value?(T(),w("small",xe,[e[8]||(e[8]=t("i",{class:"pi pi-check"},null,-1)),N(" "+q(V.value),1)])):_("",!0)])]),t("div",ye,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[t("span",{class:"text-red-500"},"*"),N(" Nombre de tabla ")],-1)),t("div",he,[v(b(ee),{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),class:"w-full",placeholder:"ej: usuarios",onInput:O},null,8,["modelValue"])]),$.value?(T(),w("div",{key:0,class:M([k.value,"text-sm mt-1"])},q($.value),3)):_("",!0)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Formato SQL ",-1)),t("div",$e,[v(b(R),{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),options:U,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øIncluir bloque CREATE TABLE? ",-1)),t("div",Se,[v(b(R),{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=a=>C.value=a),options:Y,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øGenerar una migraci√≥n Yii2? ",-1)),t("div",Ee,[v(b(R),{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=a=>I.value=a),options:F,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])])]),x.value?(T(),w("div",we,q(x.value),1)):_("",!0),y.value?(T(),w("div",Te,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Resultado SQL",-1)),v(b(te),{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=a=>y.value=a),readonly:"",class:"w-full h-64 p-3 text-sm font-mono"},null,8,["modelValue"]),t("div",Le,[v(b(A),{onClick:H,icon:"pi pi-copy",label:"Copiar SQL",class:"w-full sm:w-auto p-button-primary"}),v(b(A),{onClick:X,icon:"pi pi-download",label:"Descargar .sql",class:"w-full sm:w-auto p-button-success"})])])):_("",!0)])])])}}}),Ae=ue(Ne,[["__scopeId","data-v-65299e7b"]]);export{Ae as default};
