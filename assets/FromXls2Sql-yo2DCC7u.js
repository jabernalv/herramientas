import{u as ae,m as le,a as j,A as te,n as B,B as se,p as Y,o as D,j as oe}from"./primevue-BmZgxRPy.js";import{r as ne,u as ie}from"./xlsx-BWspZQq9.js";import{P as re,r as p,L as ce,c as T,e as a,x as d,B as g,A as I,f as ue,Y as de,j as L,k as me,R as m,p as F,t as N,d as S}from"./vue-vendor-jWyGKli5.js";import{_ as ve}from"./index-Dm6-aFba.js";const pe={class:"bg-gray-100 py-2 px-4 rounded-md shadow-sm mb-6"},fe={class:"text-sm","aria-label":"Miga de pan"},be={class:"list-none p-0 inline-flex space-x-2"},ge={class:"flex items-center"},xe={class:"w-full max-w-[90%] bg-white shadow-lg rounded-2xl p-4 md:p-6 space-y-6 mb-16"},ye={class:"space-y-4"},$e={class:"space-y-4"},he={class:"flex flex-col sm:flex-row gap-3"},Se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},we={class:"relative"},_e={class:"relative"},Ee={class:"flex items-center gap-2"},Te=["src","alt"],Le={key:0,class:"flex items-center gap-2"},Ne=["src","alt"],ke={class:"relative"},Ce={class:"relative"},Ie={key:0,class:"text-sm text-red-600 bg-red-100 border border-red-300 p-2 rounded-md mt-1"},qe={key:1,class:"space-y-2"},Ae={class:"flex flex-col sm:flex-row justify-end gap-3"},Re=re({__name:"FromXls2Sql",setup(Ve){const M=ae(),x=p(""),v=p("mysql"),q=p("yes"),A=p("no"),y=p(""),$=p(""),w=p(""),R=p(""),_=p(null),V=p(""),k=[{name:"MySQL / MariaDB",value:"mysql",icon:"mysql.svg"},{name:"PostgreSQL",value:"postgresql",icon:"postgresql.svg"},{name:"SQL Server",value:"sqlserver",icon:"sql-server.svg"},{name:"Oracle",value:"oracle",icon:"oracle.svg"}],O=[{name:"S√≠, generar CREATE TABLE",value:"yes"},{name:"No, solo INSERT INTO",value:"no"}],z=[{name:"S√≠, generar migraci√≥n",value:"yes"},{name:"No",value:"no"}],U=ce(()=>{const t=x.value.trim();return/^[a-z][a-z0-9_]*$/.test(t)}),Q=()=>{const t=x.value.trim().toLowerCase();x.value=t;const e=/^[a-z][a-z0-9_]*$/.test(t);t===""?w.value="":e?(w.value="‚úÖ Nombre v√°lido",R.value="text-green-600"):(w.value="‚ùå Nombre inv√°lido",R.value="text-red-600")},K=t=>{const e=[],l=n=>/^-?\d+$/.test(n),o=n=>/^-?\d+\.\d+$/.test(n),u=n=>/^\d{4}-\d{2}-\d{2}$/.test(n),f=t[0].length;for(let n=0;n<f;n++){const r=[];for(let b=1;b<t.length&&r.length<1e3;b++){const C=t[b][n];C!=null&&String(C).trim()!==""&&r.push(String(C))}let s=!0,c=!0,h=!0,E=0;for(const b of r)l(b)||(s=!1),!o(b)&&!l(b)&&(c=!1),u(b)||(h=!1),E=Math.max(E,b.length);E=E*10,s?e.push("INT"):c?e.push("FLOAT"):h?e.push("DATE"):e.push(`VARCHAR(${Math.min(E,255)})`)}return e},P=(t,e,i)=>{let l="`",o="`",u="`"+t+"`";v.value==="postgresql"||v.value==="oracle"?(l=o='"',u=`"${t}"`):v.value==="sqlserver"&&(l="[",o="]",u=`[${t}]`);const f=e.map((n,r)=>{let s=i[r];return n==="id"&&s==="INT"&&(v.value==="mysql"?s="INT AUTO_INCREMENT PRIMARY KEY":v.value==="postgresql"?s="SERIAL PRIMARY KEY":v.value==="sqlserver"?s="INT IDENTITY(1,1) PRIMARY KEY":v.value==="oracle"&&(s="NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY")),`${l}${n}${o} ${s}`});return`CREATE TABLE ${u} (
  ${f.join(`,
  `)}
);`},W=(t,e,i)=>{let l="`",o="`",u="`"+t+"`";v.value==="postgresql"||v.value==="oracle"?(l=o='"',u=`"${t}"`):v.value==="sqlserver"&&(l="[",o="]",u=`[${t}]`);const f=e.map(r=>`${l}${r}${o}`).join(", "),n=[];for(let r=1;r<i.length;r++){const s=i[r].map(c=>c==null?"NULL":typeof c=="string"?`'${c.replace(/'/g,"''")}'`:c);n.push(`(${s.join(", ")})`)}return n.length===0?"":`INSERT INTO ${u} (${f})
VALUES
${n.join(`,
`)};`},G=(t,e,i,l)=>{const o=`m${Date.now()}_${t}`,u=e.map((n,r)=>{let s=i[r].toLowerCase();return s.startsWith("varchar")?s=`$this->string(${s.match(/\((\d+)\)/)?.[1]||"255"})`:s==="int"?s="$this->integer()":s==="float"?s="$this->float()":s==="date"&&(s="$this->date()"),n==="id"&&s==="$this->integer()"&&(s+="->primaryKey()"),`            '${n}' => ${s},`}),f=l.slice(1).map(n=>{const r={};return e.forEach((s,c)=>{r[s]=n[c]}),r});return`<?php

use yii\\db\\Migration;

class ${o} extends Migration
{
    public function safeUp()
    {
        $this->createTable('{{%${t}}}', [
${u.join(`
`)}
        ]);

        $this->batchInsert('{{%${t}}}', 
            ['${e.join("', '")}'],
            ${JSON.stringify(f,null,4)}
        );
    }

    public function safeDown()
    {
        $this->dropTable('{{%${t}}}');
    }
}`},H=async t=>{try{const e=await t.arrayBuffer(),i=ne(e,{type:"array"});if(i.SheetNames.length!==1){y.value="El archivo debe contener exactamente una hoja.";return}const l=i.Sheets[i.SheetNames[0]],o=ie.sheet_to_json(l,{header:1});if(o.length===0||o[0].length===0){y.value="No se detectaron encabezados en la primera fila.";return}const u=o[0].map(h=>h.toLowerCase()),f=/^[a-z][a-z0-9_]*$/,n=u.filter(h=>!f.test(h));if(n.length>0){y.value="Nombres de columnas inv√°lidos: "+n.join(", ");return}const r=K(o),s=x.value.trim();let c="";q.value==="yes"&&(c+=P(s,u,r)+`

`),c+=W(s,u,o),A.value==="yes"&&(c+=`

/* === Yii2 Migration === */

`+G(s,u,r,o)),$.value=c,y.value=""}catch(e){y.value="Error al procesar el archivo: "+e.message}},X=t=>{_.value=t.files[0],V.value=t.files[0].name},J=()=>{_.value&&H(_.value)},Z=async()=>{try{await navigator.clipboard.writeText($.value),M.add({severity:"success",summary:"Copiado",detail:"SQL copiado al portapapeles",life:3e3})}catch{M.add({severity:"error",summary:"Error",detail:"No se pudo copiar al portapapeles",life:3e3})}},ee=()=>{const t=new Blob([$.value],{type:"text/plain"}),e=window.URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=`${x.value}_${new Date().toISOString().split("T")[0]}.sql`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(e),document.body.removeChild(i)};return(t,e)=>{const i=ue("router-link");return S(),T("div",null,[a("div",pe,[a("nav",fe,[a("ol",be,[a("li",ge,[d(i,{to:"/",class:"text-blue-500 hover:text-blue-700"},{default:g(()=>e[5]||(e[5]=[a("i",{class:"inline-block w-4 h-4 mr-1 align-text-bottom"},null,-1),I(" Herramientas ")])),_:1,__:[5]})]),e[6]||(e[6]=a("li",null,[a("i",{class:"inline-block w-4 h-4 text-gray-400 align-text-bottom"})],-1)),e[7]||(e[7]=a("li",{class:"text-gray-700"},"Convertidor Excel a SQL",-1))])])]),a("div",xe,[a("div",ye,[e[17]||(e[17]=de('<div data-v-ccfa9ab8><h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600" data-v-ccfa9ab8> üß© Convertidor de Excel a SQL </h1></div><div class="text-sm text-gray-600 text-center" data-v-ccfa9ab8> Sube un archivo <strong data-v-ccfa9ab8>.csv</strong>, <strong data-v-ccfa9ab8>.xls</strong> o <strong data-v-ccfa9ab8>.xlsx</strong> que contenga los datos.<br data-v-ccfa9ab8> Aseg√∫rate de que: </div><div data-v-ccfa9ab8><ul class="text-sm text-gray-600 list-disc list-inside" data-v-ccfa9ab8><li data-v-ccfa9ab8>La primera fila tenga los nombres de las columnas</li><li data-v-ccfa9ab8>Solo haya una hoja (en archivos Excel)</li><li data-v-ccfa9ab8> Los nombres de columna sean v√°lidos (letras, n√∫meros, guion bajo, comienzan con letra) </li><li data-v-ccfa9ab8> Debes elegir si deseas generar tambi√©n el bloque <code data-v-ccfa9ab8>CREATE TABLE</code></li><li data-v-ccfa9ab8>Debes proporcionar el nombre de la tabla</li></ul></div>',3)),a("div",$e,[a("div",null,[e[9]||(e[9]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[a("span",{class:"text-red-500"},"*"),I(" Selecciona un archivo ")],-1)),a("div",he,[d(m(le),{mode:"basic",auto:!1,accept:".csv,.xls,.xlsx",onSelect:X,chooseLabel:"Elegir archivo",class:"flex-1"}),d(m(j),{disabled:!_.value||!U.value,onClick:J,icon:"pi pi-file-edit",label:"Procesar",class:F(["w-full sm:w-36",!_.value||!U.value?"p-button-secondary opacity-60":"p-button-primary"])},null,8,["disabled","class"])]),V.value?(S(),me(m(te),{key:0,severity:"info",size:"small"},{default:g(()=>[e[8]||(e[8]=a("i",{class:"pi pi-check"},null,-1)),I(" "+N(V.value),1)]),_:1,__:[8]})):L("",!0)])]),a("div",Se,[a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[a("span",{class:"text-red-500"},"*"),I(" Nombre de tabla ")],-1)),a("div",we,[d(m(Y),null,{default:g(()=>[d(m(B),null,{default:g(()=>e[10]||(e[10]=[a("i",{class:"pi pi-database"},null,-1)])),_:1,__:[10]}),d(m(se),{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),class:"w-full",placeholder:"ej: usuarios",onInput:Q},null,8,["modelValue"])]),_:1})]),w.value?(S(),T("div",{key:0,class:F([R.value,"text-sm mt-1"])},N(w.value),3)):L("",!0)]),a("div",null,[e[13]||(e[13]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Formato SQL ",-1)),a("div",_e,[d(m(Y),null,{default:g(()=>[d(m(B),null,{default:g(()=>e[12]||(e[12]=[a("i",{class:"pi pi-database"},null,-1)])),_:1,__:[12]}),d(m(D),{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),options:k,optionLabel:"name",optionValue:"value",class:"w-full"},{option:g(l=>[a("div",Ee,[a("img",{src:`icons/${l.option.icon}`,alt:l.option.name,class:"w-5 h-5"},null,8,Te),a("span",null,N(l.option.name),1)])]),value:g(l=>[l.value?(S(),T("div",Le,[a("img",{src:`icons/${k.find(o=>o.value===l.value)?.icon}`,alt:k.find(o=>o.value===l.value)?.name,class:"w-5 h-5"},null,8,Ne),a("span",null,N(k.find(o=>o.value===l.value)?.name),1)])):L("",!0)]),_:1},8,["modelValue"])]),_:1})])]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øIncluir bloque CREATE TABLE? ",-1)),a("div",ke,[d(m(D),{modelValue:q.value,"onUpdate:modelValue":e[2]||(e[2]=l=>q.value=l),options:O,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])]),a("div",null,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ¬øGenerar una migraci√≥n Yii2? ",-1)),a("div",Ce,[d(m(D),{modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=l=>A.value=l),options:z,optionLabel:"name",optionValue:"value",class:"w-full"},null,8,["modelValue"])])])]),y.value?(S(),T("div",Ie,N(y.value),1)):L("",!0),$.value?(S(),T("div",qe,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700"},"Resultado SQL",-1)),d(m(oe),{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=l=>$.value=l),readonly:"",class:"w-full h-64 p-3 text-sm font-mono"},null,8,["modelValue"]),a("div",Ae,[d(m(j),{onClick:Z,icon:"pi pi-copy",label:"Copiar SQL",class:"w-full sm:w-auto p-button-primary"}),d(m(j),{onClick:ee,icon:"pi pi-download",label:"Descargar .sql",class:"w-full sm:w-auto p-button-success"})])])):L("",!0)])])])}}}),Be=ve(Re,[["__scopeId","data-v-ccfa9ab8"]]);export{Be as default};
