<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=90vw, initial-scale=1.0" />
    <title>Vista en Tiempo Real: Markdown / AsciiDoc</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- marked.js para Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- asciidoctor.js para AsciiDoc -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/asciidoctor.js/1.5.5-5/asciidoctor.min.js"
      integrity="sha512-J7IXHi6LD/94IioL/slk1hNk85wBBH7x8zpyaAiqBd801N/zcSDXWQknUtgriVuwNeG3rjqWdvcHoYhMaRE4Ew=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- html2pdf.js para exportar a PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  </head>
  <body
    class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans"
  >
    <!-- Miga de pan en ancho completo -->
    <header class="w-full bg-gray-100 py-3 px-6 shadow-sm mb-4">
      <nav class="text-sm max-w-7xl mx-auto" aria-label="Miga de pan">
        <ol class="list-none p-0 flex space-x-2">
          <li class="flex items-center">
            <a
              href="herramientas.html"
              class="text-blue-500 hover:text-blue-700"
            >
              <i
                data-lucide="wrench-screwdriver"
                class="inline-block w-4 h-4 mr-1 align-text-bottom"
              ></i>
              Herramientas
            </a>
          </li>
          <li>
            <i
              data-lucide="chevron-right"
              class="inline-block w-4 h-4 text-gray-400 align-text-bottom"
            ></i>
          </li>
          <li class="text-gray-700">Visor de Markdown y AsciiDoc</li>
        </ol>
      </nav>
    </header>

    <main class="w-full flex flex-col items-center justify-center">
      <div
        class="w-full sm:w-[95vw] lg:w-[90vw] max-w-none bg-white rounded-xl shadow-2xl p-6"
      >
        <div class="flex items-center mb-6 gap-3">
          <i data-lucide="book-open" class="w-8 h-8 text-indigo-600"></i>
          <h1
            class="text-3xl font-bold text-indigo-700 flex items-center gap-2"
          >
            Vista en tiempo real
            <i data-lucide="eye" class="w-6 h-6 text-indigo-500"></i>
          </h1>
          <div class="ml-auto flex items-center gap-2">
            <i data-lucide="settings" class="w-5 h-5 text-indigo-400"></i>
            <select
              id="format-selector"
              class="rounded-lg border border-indigo-200 px-3 py-1 text-indigo-700 bg-indigo-50 focus:ring-2 focus:ring-indigo-400"
            >
              <option value="markdown" selected>Markdown</option>
              <option value="asciidoc">AsciiDoc</option>
            </select>
          </div>
        </div>
        <div class="flex flex-col md:flex-row gap-6">
          <!-- Entrada -->
          <div class="w-full md:w-1/2 flex flex-col">
            <label
              for="input-area"
              class="flex items-center gap-2 text-lg font-semibold text-gray-700 mb-2"
            >
              <i data-lucide="edit-3" class="w-5 h-5 text-indigo-400"></i>
              Escribe tu texto
            </label>
            <textarea
              id="input-area"
              class="resize-none h-72 rounded-lg border border-indigo-200 focus:ring-2 focus:ring-indigo-400 p-4 text-gray-800 bg-indigo-50 shadow-inner transition"
              placeholder="## Escribe aquí tu *Markdown* o tu AsciiDoc..."
            ></textarea>

            <!-- Botón descarga fuente -->
            <button
              id="download-source"
              class="mt-4 w-fit px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
            >
              <i data-lucide="download" class="w-5 h-5"></i>
              Descargar archivo fuente
            </button>
          </div>

          <!-- Vista previa -->
          <div class="w-full md:w-1/2 flex flex-col">
            <label
              class="flex items-center gap-2 text-lg font-semibold text-gray-700 mb-2"
            >
              <i data-lucide="eye" class="w-5 h-5 text-indigo-400"></i>
              Vista previa
            </label>
            <div
              id="preview"
              class="prose prose-indigo bg-indigo-50 h-72 overflow-y-auto p-4 rounded-lg shadow-inner border border-indigo-100 transition"
            ></div>

            <!-- Botón descarga PDF -->
            <button
              id="download-pdf"
              class="mt-4 w-fit px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
            >
              <i data-lucide="file-text" class="w-5 h-5"></i>
              Descargar PDF
            </button>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        lucide.createIcons();

        const textarea = document.getElementById("input-area");
        const preview = document.getElementById("preview");
        const selector = document.getElementById("format-selector");
        let asciidoctor = null;

        function getAsciidoctor() {
          if (!asciidoctor && window.Asciidoctor) {
            asciidoctor = Asciidoctor();
          }
          return asciidoctor;
        }

        function renderPreview() {
          const value = textarea.value;
          const format = selector.value;
          if (format === "markdown") {
            preview.innerHTML = marked.parse(value);
          } else if (format === "asciidoc") {
            const adoc = getAsciidoctor();
            if (adoc) {
              preview.innerHTML = adoc.convert(value);
            } else {
              preview.innerHTML =
                '<p class="text-red-500">Asciidoctor.js no está cargado.</p>';
            }
          }
        }

        textarea.addEventListener("input", renderPreview);
        selector.addEventListener("change", renderPreview);
        renderPreview();

        // Descargar fuente
        document
          .getElementById("download-source")
          .addEventListener("click", () => {
            const text = textarea.value;
            const format = selector.value;
            const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download =
              format === "markdown" ? "document.md" : "document.adoc";
            a.click();
          });
        // Descargar PDF
        document
          .getElementById("download-pdf")
          .addEventListener("click", () => {
            const visibleContent = document.getElementById("preview").innerHTML;
            const printable = document.getElementById("printable");

            // Copiar contenido visible al contenedor sin scroll
            printable.innerHTML = visibleContent;

            // Mostrar temporalmente para permitir el renderizado
            printable.classList.remove("hidden");

            const opt = {
              margin: 0.5,
              filename: "documento.pdf",
              image: { type: "jpeg", quality: 0.98 },
              html2canvas: { scale: 2, useCORS: true },
              jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
            };

            html2pdf()
              .set(opt)
              .from(printable)
              .save()
              .then(() => {
                // Ocultar nuevamente después de generar el PDF
                printable.classList.add("hidden");
              });
          });
      });
    </script>
    <!-- Div oculto con estilo adecuado -->
    <div id="printable" class="prose prose-indigo p-6 bg-white hidden"></div>
  </body>
</html>
